{"ast":null,"code":"import { authAPI, captchaAPI, loginAPI, ResultCodeForCaptcha, ResultCodesEnum } from \"../api/api\";\nconst SETUSERSTATE = \"soc_network_auth_set_user_auth_state\";\nconst TOGGLELOGINLOADING = \"soc_network_auth_toggle_is_loading_login\";\nconst LOGIN_FAILED = \"soc_network_auth_log_fail\";\nconst GET_CAPTCHA_URL_SUCCESS = \"soc_network_auth_received_captcha_url\";\nlet initialState = {\n  data: {\n    userId: null,\n    email: null,\n    login: null,\n    isAuth: false,\n    login_failed: null,\n    captchaURL: null // if null - captcha not required\n\n  },\n  isFetching: false\n};\n\nlet authReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case SETUSERSTATE:\n      {\n        return { ...state,\n          data: action.payload\n        };\n      }\n      ;\n\n    case TOGGLELOGINLOADING:\n      {\n        return { ...state,\n          isFetching: action.isFetching\n        };\n      }\n\n    case LOGIN_FAILED:\n      {\n        return { ...state,\n          data: { ...state.data,\n            login_failed: action.login_failed\n          }\n        };\n      }\n      ;\n\n    case GET_CAPTCHA_URL_SUCCESS:\n      {\n        return { ...state,\n          data: { ...state.data,\n            captchaURL: action.captchaURL\n          }\n        };\n      }\n      ;\n\n    default:\n      return state;\n  }\n};\n\nconst setAuthUserData = (userId, email, login, isAuth, login_failed, captchaURL) => ({\n  type: SETUSERSTATE,\n  payload: {\n    userId,\n    email,\n    login,\n    isAuth,\n    login_failed,\n    captchaURL\n  }\n});\n\nconst toggleIsLoadingLogin = isFetching => ({\n  type: TOGGLELOGINLOADING,\n  isFetching\n});\n\nconst toggle_failed_login = login_failed => ({\n  type: LOGIN_FAILED,\n  login_failed\n});\n\nconst setCaptchaURL = captchaURL => ({\n  type: GET_CAPTCHA_URL_SUCCESS,\n  captchaURL\n}); // Check if signed in\n\n\nexport const singInProcessCheck = () => {\n  return async (dispatch, getState) => {\n    dispatch(toggleIsLoadingLogin(true));\n    let response = await authAPI.getLoginData();\n    dispatch(toggleIsLoadingLogin(false));\n\n    if (response.resultCode === ResultCodesEnum.Success) {\n      let {\n        id,\n        email,\n        login\n      } = response.data;\n      let captchaURL = null;\n      dispatch(setAuthUserData(id, email, login, true, false, captchaURL));\n    } else console.log(\"error no login\");\n  };\n}; // sign me in\n\nexport const singInLogin = values => {\n  return async (dispatch, getState) => {\n    if (!values.remember_me) {\n      values = { ...values,\n        remember_me: false\n      };\n    }\n\n    let response = await loginAPI.signInData(values);\n\n    if (response.resultCode === ResultCodesEnum.Success) {\n      dispatch(singInProcessCheck());\n    } else {\n      if (response.resultCode === ResultCodeForCaptcha.CaptchaError) {\n        dispatch(getCaptchaURL());\n      }\n\n      dispatch(toggle_failed_login(true));\n    }\n  };\n};\nexport const singOutLogin = () => {\n  return async (dispatch, getState) => {\n    let response = await loginAPI.signOutData();\n\n    if (response.data.resultCode === 0) {\n      dispatch(setAuthUserData(null, null, null, false, null, null));\n    } else {\n      console.log(\"no sign out\");\n    }\n  };\n};\nexport const getCaptchaURL = () => {\n  return async (dispatch, getState) => {\n    const response = await captchaAPI.getCaptchaUrl();\n    const captchaUrl = response.data.url;\n    dispatch(setCaptchaURL(captchaUrl));\n  };\n};\nexport default authReducer;","map":{"version":3,"sources":["C:/Users/marii/OneDrive/Desktop/JavaScript/react_app/src/redux/authReducer.ts"],"names":["authAPI","captchaAPI","loginAPI","ResultCodeForCaptcha","ResultCodesEnum","SETUSERSTATE","TOGGLELOGINLOADING","LOGIN_FAILED","GET_CAPTCHA_URL_SUCCESS","initialState","data","userId","email","login","isAuth","login_failed","captchaURL","isFetching","authReducer","state","action","type","payload","setAuthUserData","toggleIsLoadingLogin","toggle_failed_login","setCaptchaURL","singInProcessCheck","dispatch","getState","response","getLoginData","resultCode","Success","id","console","log","singInLogin","values","remember_me","signInData","CaptchaError","getCaptchaURL","singOutLogin","signOutData","getCaptchaUrl","captchaUrl","url"],"mappings":"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","sourcesContent":["import {authAPI, captchaAPI, loginAPI, ResultCodeForCaptcha, ResultCodesEnum} from \"../api/api\";\r\nimport {ThunkAction} from \"redux-thunk\";\r\nimport {AppStateType} from \"./redux_store\";\r\n\r\n\r\nconst SETUSERSTATE = \"soc_network_auth_set_user_auth_state\";\r\nconst TOGGLELOGINLOADING = \"soc_network_auth_toggle_is_loading_login\";\r\nconst LOGIN_FAILED = \"soc_network_auth_log_fail\";\r\nconst GET_CAPTCHA_URL_SUCCESS = \"soc_network_auth_received_captcha_url\";\r\n\r\ntype DataType =\r\n{\r\n    userId: null | number,\r\n    email: null | string,\r\n    login: null | string,\r\n    isAuth: boolean,\r\n\r\n    login_failed: boolean | null,\r\n    captchaURL: null | string\r\n}\r\n\r\ntype InitialStateType = {\r\n    data:DataType ,\r\n    isFetching: boolean\r\n}\r\n\r\nlet initialState: InitialStateType = {\r\n\r\n    data: {\r\n        userId: null,\r\n        email: null,\r\n        login: null,\r\n        isAuth: false,\r\n        login_failed: null,\r\n        captchaURL: null // if null - captcha not required\r\n    }  ,\r\n    isFetching: false\r\n}\r\n\r\n\r\nlet authReducer = (state = initialState, action: ActionType): InitialStateType => {\r\n\r\n    switch (action.type) {\r\n        case SETUSERSTATE: {\r\n\r\n            return {\r\n                ...state,\r\n                data: action.payload\r\n            }\r\n        }\r\n            ;\r\n        case TOGGLELOGINLOADING: {\r\n            return {\r\n                ...state,\r\n                isFetching: action.isFetching\r\n            }\r\n        }\r\n        case LOGIN_FAILED : {\r\n            return {\r\n                ...state,\r\n                data: {...state.data, login_failed: action.login_failed}\r\n            }\r\n        }\r\n            ;\r\n        case GET_CAPTCHA_URL_SUCCESS: {\r\n            return {\r\n                ...state,\r\n                data: {...state.data, captchaURL: action.captchaURL}\r\n            }\r\n        }\r\n            ;\r\n        default:\r\n            return state;\r\n    }\r\n}\r\ntype ActionType = SetAuthUserDataType | ToggleIsLoadingLoginType | ToggleFailedLoginType |SetCaptchaUrlType\r\ntype SetAuthUserDataPayloadType = {\r\n    userId: number | null, email: string | null, login: string | null, isAuth: boolean, login_failed: boolean |null, captchaURL: string | null\r\n}\r\ntype SetAuthUserDataType = {\r\n    type: typeof SETUSERSTATE,\r\n    payload: SetAuthUserDataPayloadType\r\n}\r\n\r\nconst setAuthUserData = (userId: number | null, email: string | null, login: string | null, isAuth: boolean, login_failed: boolean |null, captchaURL: string|null): SetAuthUserDataType => ({\r\n    type: SETUSERSTATE,\r\n    payload: {userId, email, login, isAuth, login_failed, captchaURL}\r\n});\r\ntype ToggleIsLoadingLoginType = {\r\n    type: typeof TOGGLELOGINLOADING,\r\n    isFetching: boolean\r\n}\r\nconst toggleIsLoadingLogin = (isFetching: boolean): ToggleIsLoadingLoginType => ({type: TOGGLELOGINLOADING, isFetching});\r\n\r\ntype ToggleFailedLoginType = {\r\n    type: typeof LOGIN_FAILED,\r\n    login_failed: boolean\r\n}\r\n\r\nconst toggle_failed_login = (login_failed: boolean): ToggleFailedLoginType => ({type: LOGIN_FAILED, login_failed});\r\n\r\ntype SetCaptchaUrlType = {\r\n    type: typeof GET_CAPTCHA_URL_SUCCESS,\r\n    captchaURL: string\r\n}\r\nconst setCaptchaURL = (captchaURL: string): SetCaptchaUrlType => ({type: GET_CAPTCHA_URL_SUCCESS, captchaURL});\r\n\r\n// Check if signed in\r\ntype ThunkType = ThunkAction<Promise<void>, AppStateType, any, ActionType>\r\nexport const singInProcessCheck = (): ThunkType => {\r\n    return async (dispatch, getState) => {\r\n        dispatch(toggleIsLoadingLogin(true));\r\n        let response = await authAPI.getLoginData()\r\n        dispatch(toggleIsLoadingLogin(false));\r\n        if (response.resultCode === ResultCodesEnum.Success ) {\r\n            let {id, email, login} = response.data;\r\n            let captchaURL = null;\r\n            dispatch(setAuthUserData(id, email, login, true, false, captchaURL));\r\n        } else console.log(\"error no login\")\r\n    }\r\n\r\n};\r\n// sign me in\r\nexport type ValuesType= {\r\n    login: string,\r\n    password: string,\r\n    remember_me: any\r\n    captcha: null | string\r\n}\r\nexport const singInLogin = (values: ValuesType): ThunkType => {\r\n    return async (dispatch, getState) => {\r\n        if (!values.remember_me) {\r\n            values = {...values, remember_me: false};\r\n        }\r\n        let response = await loginAPI.signInData(values)\r\n        if (response.resultCode === ResultCodesEnum.Success) {\r\n            dispatch(singInProcessCheck());\r\n        } else {\r\n            if (response.resultCode === ResultCodeForCaptcha.CaptchaError) {\r\n                dispatch(getCaptchaURL());\r\n            }\r\n            dispatch(toggle_failed_login(true));\r\n        }\r\n    }\r\n};\r\n\r\nexport const singOutLogin = () : ThunkType=> {\r\n    return async (dispatch , getState) => {\r\n        let response = await loginAPI.signOutData();\r\n        if (response.data.resultCode === 0) {\r\n            dispatch(setAuthUserData(null, null, null, false, null, null));\r\n        } else {\r\n            console.log(\"no sign out\")\r\n        }\r\n    }\r\n};\r\n\r\nexport const getCaptchaURL = (): ThunkType => {\r\n    return async (dispatch ,getState) => {\r\n        const response = await captchaAPI.getCaptchaUrl();\r\n        const captchaUrl = response.data.url;\r\n        dispatch(setCaptchaURL(captchaUrl));\r\n    }\r\n}\r\n\r\nexport default authReducer; "]},"metadata":{},"sourceType":"module"}